## 1.先将项目提交到 github

## 2.本地打开项目 执行 npx wrangler login执行登陆

## 3.本地项目执行 npx wrangler whoami 查看 Account ID

## 4.在一个linux终端生成32位秘钥 openssl rand -base64 32

## 5.这个秘钥用于对接第三方登录用于后续配置 最好测试环境和发布分支用不同的值

## 6.本地 pnpm install 安装依赖

## 7.本地执行 npx wrangler pages project create cloudflare-worker-template-test --production-branch=develop 创建测试项目并绑定develop分支

## 8.本地执行 npx wrangler pages project create cloudflare-worker-template-prod --production-branch=main 创建发布项目并绑定main分支

## 9.本地执行 pnpm run db:create:prod 创建正式版的数据库 也可以手动创建

## 10.本地执行 pnpm run db:create:test 创建测试版数据库 也可以手动创建

## 11.本地执行 pnpm run r2:create:test 和 pnpm run r2:create:prod 创建存储桶

## 12.本地执行 pnpm run kv:create:test 和 pnpm run kv:create:prod 创建kv缓存

## 13.检查 wrangler.prod.toml 和 wrangler.test.toml 的配置 和上述创建的内容保持一致

## 14.本地执行 合并本地数据库 pnpm run db:migrate:local

## 15.本地执行 pnpm run db:seed -- --env=local 导入种子数据

## 16.本地 执行 pnpm build 和 pnpm dev 可以基础编译和测试一些逻辑

## 17.在cloudeflare里创建一个 api_token 具有编辑和发布项目的权限 方便 CI推送项目到 Claudeflare

## 18.在github的 https://github.com/dsdgdxxx/photo-studio-cf/settings/secrets/actions 里设置 CLOUDFLARE_ACCOUNT_ID CLOUDFLARE_API_TOKEN NEXTAUTH_SECRET

## 19.在github的 https://github.com/dsdgdxxx/photo-studio-cf/settings/actions 里设置 Workflow permissions 具有读写权限和Allow GitHub Actions to create and approve pull requests

## 20.在 https://github.com/dsdgdxxx/photo-studio-cf/settings/environments/ 里 找到 发布和测试两个环境 分别设置

## 在仓库 **Settings → Secrets and variables → Actions** 中定义以下密钥，以便 CI/CD 工作流可以创建数据库、执行迁移并部署页面：

| 名称                                        | 用途                                                                   |
| ------------------------------------------- | ---------------------------------------------------------------------- |
| `CLOUDFLARE_API_TOKEN`                      | 授权 Wrangler 创建/迁移 D1、R2、KV 并部署 Pages                        |
| `CLOUDFLARE_ACCOUNT_ID`                     | 标识 Cloudflare 账户，供 Wrangler 调用                                 |
| `NEXTAUTH_SECRET`                           | NextAuth JWT 会话所需，使用 `wrangler secret put NEXTAUTH_SECRET` 设置 |
| `GOOGLE_CLIENT_ID` / `GOOGLE_CLIENT_SECRET` | NextAuth 的 Google OAuth 凭据，两项必须成对配置                        |

## 21.修改代码推送到github main分支和develop分支会自动编译成可以打包下载、

## 22.github自动推送的配置
